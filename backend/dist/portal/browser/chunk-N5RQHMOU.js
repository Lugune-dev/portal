import{$a as r,G as g,eb as c,h as s,mb as p,n as m,q as u,t as l}from"./chunk-ZQSPQ25S.js";var f=class i{constructor(t,a,e){this.http=t;this.router=a;this.platformId=e}apiUrl="https://portal-api-z927.onrender.com/";validRoles=["admin","director","manager","employee"];authState=new s(this.isAuthenticated());authState$=this.authState.asObservable();isValidRole(t){return this.validRoles.includes(t?.trim()||"")}login(t,a){return this.http.post(`${this.apiUrl}https://portal-api-z927.onrender.com/login`,{email:t,password:a}).pipe(m(e=>{if(r(this.platformId)){localStorage.setItem("auth_token","dummy");let o={1:"admin",2:"admin",3:"director",4:"manager",5:"employee",6:"employee"}[e.user?.UserRoleID]||"employee";localStorage.setItem("user_role",o),localStorage.setItem("user_id",e.user?.UserID?.toString());let n=`${e.user?.FirstName||""} ${e.user?.LastName||""}`.trim();localStorage.setItem("user_name",n||e.user?.Email),e.user&&e.user.Email&&localStorage.setItem("user_email",e.user.Email),localStorage.setItem("first_name",e.user?.FirstName||""),localStorage.setItem("last_name",e.user?.LastName||""),localStorage.setItem("org_unit_id",e.user?.OrgUnitID?.toString())}this.authState.next(!0)}))}logout(){r(this.platformId)&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_role"),localStorage.removeItem("user_id"),localStorage.removeItem("user_name"),localStorage.removeItem("first_name"),localStorage.removeItem("last_name")),this.authState.next(!1),this.router.navigate(["/"])}isAuthenticated(){return r(this.platformId)?!!this.getToken():!1}getUserName(){return r(this.platformId)?localStorage.getItem("user_name"):null}getFirstName(){return r(this.platformId)?localStorage.getItem("first_name"):null}getLastName(){return r(this.platformId)?localStorage.getItem("last_name"):null}getFullName(){let t=this.getFirstName(),a=this.getLastName();if(t||a)return`${t||""} ${a||""}`.trim();let e=this.getUserName();if(e&&e.includes("@")){let o=e.split("@")[0].split(".");if(o.length>=2){let n=o[0].charAt(0).toUpperCase()+o[0].slice(1).toLowerCase(),I=o[1].charAt(0).toUpperCase()+o[1].slice(1).toLowerCase();return`${n} ${I}`}}return e}getUserEmail(){return r(this.platformId)?localStorage.getItem("user_email"):null}getToken(){return r(this.platformId)?localStorage.getItem("auth_token"):null}getRole(){if(!r(this.platformId))return null;let t=localStorage.getItem("user_role");return t?t.trim():null}getUserId(){if(!r(this.platformId))return null;let t=localStorage.getItem("user_id");return t?parseInt(t,10):null}getOrgUnitId(){if(!r(this.platformId))return null;let t=localStorage.getItem("org_unit_id");return t?parseInt(t,10):null}getUserRoleName(){return this.getRole()}forgotPassword(t){return this.http.post(`${this.apiUrl}https://portal-api-z927.onrender.com/forgot-password`,{email:t})}changePassword(t,a){return this.http.post(`${this.apiUrl}https://portal-api-z927.onrender.com/change-password`,{currentPassword:t,newPassword:a})}static \u0275fac=function(a){return new(a||i)(l(c),l(p),l(g))};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};export{f as a};
